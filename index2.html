<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>xxx</title>
</head>
<body>

    <script>

    var audioContext;
    var playSoundBuffer;

    function init() {
        window.AudioContext = window.AudioContext || window.webkitAudioContext;
        audioContext = new AudioContext();

        loadNote();
    }

    function loadNote() {
        var request = new XMLHttpRequest();
        request.open("GET", "foo.wav", true);
        request.responseType = "arraybuffer";
        request.onload = function() {
            audioContext.decodeAudioData(request.response, function(buffer) {
                playSoundBuffer = buffer;
                playSound(); // don't start processing it before the response is there!
            }, function(error) {
                console.error("decodeAudioData error", error);
            });
        };
        request.send();//start doing something async

    }

    function playSound() {
        var source = audioContext.createBufferSource();
        source.buffer = playSoundBuffer;       // This is the line that generates the error
        source.connect(audioContext.destination);
        source.start(0);
    }

    init();

    </script>

</body>
</html>
